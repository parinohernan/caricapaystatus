<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÔøΩÔøΩ Debug Deep Links - Carica</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
        }
        .debug-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #007bff;
        }
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 8px;
            border: none;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }
        .btn-success { background: #28a745; color: white; }
        .btn-failure { background: #dc3545; color: white; }
        .btn-pending { background: #ffc107; color: #212529; }
        .btn-debug { background: #6f42c1; color: white; }
        
        .log {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 20px;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
            font-weight: bold;
        }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
        .status.warning { background: #fff3cd; color: #856404; }
        
        .url-display {
            background: #2d3748;
            color: #e2e8f0;
            padding: 10px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 11px;
            word-break: break-all;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ÔøΩÔøΩ Debug Deep Links - Carica</h1>
        
        <div class="debug-section">
            <h3>üì± Estado del Dispositivo</h3>
            <div id="device-info"></div>
        </div>

        <div class="debug-section">
            <h3>ÔøΩÔøΩ Pruebas B√°sicas</h3>
            <p>Estas pruebas verifican si los deep links b√°sicos funcionan:</p>
            
            <button class="btn btn-debug" onclick="testBasicDeepLink()">Test: carica://</button>
            <button class="btn btn-debug" onclick="testPaymentDeepLink()">Test: carica://payment</button>
            <button class="btn btn-debug" onclick="testSimpleSuccess()">Test: carica://payment/success</button>
            
            <div class="url-display" id="current-url"></div>
        </div>

        <div class="debug-section">
            <h3>üí∞ Pruebas de Pago (Sin Par√°metros)</h3>
            <p>Pruebas sin par√°metros para verificar el routing b√°sico:</p>
            
            <button class="btn btn-success" onclick="testSuccessNoParams()">‚úÖ Success (sin params)</button>
            <button class="btn btn-failure" onclick="testFailureNoParams()">‚ùå Failure (sin params)</button>
            <button class="btn btn-pending" onclick="testPendingNoParams()">‚è≥ Pending (sin params)</button>
        </div>

        <div class="debug-section">
            <h3>üîß Pruebas con Par√°metros M√≠nimos</h3>
            <p>Pruebas con solo los par√°metros esenciales:</p>
            
            <button class="btn btn-success" onclick="testSuccessMinimal()">‚úÖ Success (m√≠nimo)</button>
            <button class="btn btn-failure" onclick="testFailureMinimal()">‚ùå Failure (m√≠nimo)</button>
            <button class="btn btn-pending" onclick="testPendingMinimal()">‚è≥ Pending (m√≠nimo)</button>
        </div>

        <div class="debug-section">
            <h3>üìä Pruebas Completas</h3>
            <p>Pruebas con todos los par√°metros de MercadoPago:</p>
            
            <button class="btn btn-success" onclick="testSuccessFull()">‚úÖ Success (completo)</button>
            <button class="btn btn-failure" onclick="testFailureFull()">‚ùå Failure (completo)</button>
            <button class="btn btn-pending" onclick="testPendingFull()">‚è≥ Pending (completo)</button>
        </div>

        <div class="log" id="log"></div>
    </div>

    <script>
        let testCounter = 0;
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logElement = document.getElementById('log');
            const logMessage = `[${timestamp}] ${message}`;
            
            console.log(logMessage);
            logElement.innerHTML += `<div class="status ${type}">${logMessage}</div>`;
            logElement.scrollTop = logElement.scrollHeight;
        }

        function testDeepLink(url, description) {
            testCounter++;
            log(`üß™ Test #${testCounter}: ${description}`, 'warning');
            log(`üîó URL: ${url}`, 'info');
            
            document.getElementById('current-url').textContent = url;
            
            try {
                // Intentar abrir el deep link
                window.location.href = url;
                log('‚úÖ Redirecci√≥n iniciada', 'success');
                
                // Verificar despu√©s de un tiempo
                setTimeout(() => {
                    log('üîç Verificando si la app se abri√≥...', 'info');
                }, 2000);
                
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }

        // Pruebas b√°sicas
        function testBasicDeepLink() {
            testDeepLink('carica://', 'Deep link b√°sico');
        }

        function testPaymentDeepLink() {
            testDeepLink('carica://payment', 'Deep link payment');
        }

        function testSimpleSuccess() {
            testDeepLink('carica://payment/success', 'Deep link success simple');
        }

        // Pruebas sin par√°metros
        function testSuccessNoParams() {
            testDeepLink('carica://payment/success', 'Success sin par√°metros');
        }

        function testFailureNoParams() {
            testDeepLink('carica://payment/failure', 'Failure sin par√°metros');
        }

        function testPendingNoParams() {
            testDeepLink('carica://payment/pending', 'Pending sin par√°metros');
        }

        // Pruebas con par√°metros m√≠nimos
        function testSuccessMinimal() {
            const url = 'carica://payment/success?payment_id=123456789&status=approved';
            testDeepLink(url, 'Success con par√°metros m√≠nimos');
        }

        function testFailureMinimal() {
            const url = 'carica://payment/failure?payment_id=123456789&status=rejected';
            testDeepLink(url, 'Failure con par√°metros m√≠nimos');
        }

        function testPendingMinimal() {
            const url = 'carica://payment/pending?payment_id=123456789&status=pending';
            testDeepLink(url, 'Pending con par√°metros m√≠nimos');
        }

        // Pruebas completas
        function testSuccessFull() {
            const params = new URLSearchParams({
                payment_id: '1234567890',
                status: 'approved',
                preference_id: 'pref_test_001',
                collection_id: '1234567890',
                collection_status: 'approved',
                external_reference: 'test_ref_001',
                payment_type: 'credit_card',
                merchant_order_id: '1234567890'
            });
            const url = `carica://payment/success?${params.toString()}`;
            testDeepLink(url, 'Success con par√°metros completos');
        }

        function testFailureFull() {
            const params = new URLSearchParams({
                payment_id: '1234567891',
                status: 'rejected',
                preference_id: 'pref_test_002',
                collection_id: '1234567891',
                collection_status: 'rejected',
                external_reference: 'test_ref_002',
                payment_type: 'credit_card',
                merchant_order_id: '1234567891'
            });
            const url = `carica://payment/failure?${params.toString()}`;
            testDeepLink(url, 'Failure con par√°metros completos');
        }

        function testPendingFull() {
            const params = new URLSearchParams({
                payment_id: '1234567892',
                status: 'pending',
                preference_id: 'pref_test_003',
                collection_id: '1234567892',
                collection_status: 'pending',
                external_reference: 'test_ref_003',
                payment_type: 'credit_card',
                merchant_order_id: '1234567892'
            });
            const url = `carica://payment/pending?${params.toString()}`;
            testDeepLink(url, 'Pending con par√°metros completos');
        }

        // Detectar eventos
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                log('üì± P√°gina oculta - posiblemente la app se abri√≥', 'success');
            } else {
                log('ÔøΩÔøΩ P√°gina visible nuevamente', 'info');
            }
        });

        window.addEventListener('blur', () => {
            log('üîç Ventana perdi√≥ el foco - posiblemente la app se abri√≥', 'success');
        });

        window.addEventListener('focus', () => {
            log('üéØ Ventana recuper√≥ el foco', 'info');
        });

        // Mostrar informaci√≥n del dispositivo
        function showDeviceInfo() {
            const deviceInfo = document.getElementById('device-info');
            deviceInfo.innerHTML = `
                <div class="status info">
                    <strong>üì± Informaci√≥n del Dispositivo:</strong><br>
                    User Agent: ${navigator.userAgent}<br>
                    Plataforma: ${navigator.platform}<br>
                    Resoluci√≥n: ${window.screen.width}x${window.screen.height}<br>
                    URL actual: ${window.location.href}
                </div>
            `;
        }

        // Inicializar
        showDeviceInfo();
        log('üöÄ P√°gina de debug cargada', 'success');
        log('ÔøΩÔøΩ Instrucciones:', 'info');
        log('1. Haz clic en las pruebas en orden (b√°sicas ‚Üí sin params ‚Üí m√≠nimas ‚Üí completas)', 'info');
        log('2. Observa si la app se abre y a qu√© pantalla va', 'info');
        log('3. Si la app se abre pero queda en blanco, el problema est√° en el routing', 'warning');
        log('4. Si la app no se abre, el problema est√° en la configuraci√≥n de deep links', 'warning');
    </script>
</body>
</html>